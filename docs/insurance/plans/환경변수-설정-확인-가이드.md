# .env 파일 설정 확인 가이드

## ✅ 현재 상태 확인

서버에서 다음 명령어로 확인하세요:

### 1. 파일 권한 확인
```bash
ls -la .env
```

**올바른 출력:**
```
-rw-------  1 pci0327 pci0327    86  1월 17 13:05 .env
```

✅ **권한 600 확인**: `-rw-------` (소유자만 읽기/쓰기) - **올바름**

### 2. 파일 내용 확인
```bash
cat .env
```

**올바른 형식:**
```
JUMIN_ENCRYPTION_KEY=6e7891ec35...전체64자리키...
```

### 3. 키 길이 확인 (중요!)

```bash
# 키 값만 추출하여 길이 확인
grep JUMIN_ENCRYPTION_KEY .env | cut -d'=' -f2 | wc -c
```

**올바른 결과:**
- 출력: `65` (64자리 키 + 줄바꿈 문자 1개)
- 또는: `64` (줄바꿈 없이)

**키 길이가 64자리가 아니면 오류가 발생합니다!**

### 4. 키 형식 확인 (16진수만 포함)

```bash
# 키 값만 추출하여 16진수 형식 확인
grep JUMIN_ENCRYPTION_KEY .env | cut -d'=' -f2 | grep -E '^[0-9a-fA-F]{64}$'
```

**올바른 결과:**
- 64자리 16진수 문자열이 출력되어야 합니다.
- 아무것도 출력되지 않으면 형식이 잘못되었습니다.

### 5. 전체 키 값 확인

```bash
# 키 값 전체 확인 (보안상 주의)
grep JUMIN_ENCRYPTION_KEY .env | cut -d'=' -f2
```

**확인 사항:**
- ✅ 정확히 64자리인가?
- ✅ 0-9, a-f (또는 A-F)만 포함하는가?
- ✅ 공백이나 특수문자가 없는가?

---

## 🔍 상세 확인 스크립트

서버에서 다음 스크립트를 실행하여 모든 항목을 확인하세요:

```bash
cat > /tmp/check-env.sh << 'EOF'
#!/bin/bash
echo "=== .env 파일 확인 ==="
echo ""

# 1. 파일 존재 확인
if [ ! -f .env ]; then
    echo "❌ 오류: .env 파일이 없습니다."
    exit 1
fi
echo "✅ .env 파일 존재"

# 2. 파일 권한 확인
PERM=$(stat -c "%a" .env 2>/dev/null || stat -f "%OLp" .env 2>/dev/null)
if [ "$PERM" = "600" ]; then
    echo "✅ 파일 권한: 600 (올바름)"
else
    echo "⚠️  파일 권한: $PERM (600 권장)"
fi

# 3. 키 존재 확인
if ! grep -q "^JUMIN_ENCRYPTION_KEY=" .env; then
    echo "❌ 오류: JUMIN_ENCRYPTION_KEY가 없습니다."
    exit 1
fi
echo "✅ JUMIN_ENCRYPTION_KEY 존재"

# 4. 키 값 추출
KEY=$(grep "^JUMIN_ENCRYPTION_KEY=" .env | cut -d'=' -f2 | tr -d '\r\n')

# 5. 키 길이 확인
KEY_LEN=${#KEY}
if [ "$KEY_LEN" = "64" ]; then
    echo "✅ 키 길이: $KEY_LEN (올바름)"
else
    echo "❌ 오류: 키 길이가 $KEY_LEN입니다. 64자리여야 합니다."
    exit 1
fi

# 6. 키 형식 확인 (16진수만)
if echo "$KEY" | grep -qE '^[0-9a-fA-F]{64}$'; then
    echo "✅ 키 형식: 올바름 (16진수 64자리)"
else
    echo "❌ 오류: 키 형식이 올바르지 않습니다. (16진수 64자리 필요)"
    exit 1
fi

echo ""
echo "=== 모든 확인 완료 ==="
echo "✅ .env 파일 설정이 올바릅니다!"
EOF

chmod +x /tmp/check-env.sh
cd /path/to/www
/tmp/check-env.sh
rm /tmp/check-env.sh
```

---

## ❌ 일반적인 오류

### 오류 1: 키 길이가 64자리가 아님
```bash
# 확인
grep JUMIN_ENCRYPTION_KEY .env | cut -d'=' -f2 | wc -c
# 출력이 65가 아니면 오류
```

**해결**: 새 키를 생성하여 다시 설정하세요.

### 오류 2: 키에 공백이나 특수문자 포함
```bash
# 확인
grep JUMIN_ENCRYPTION_KEY .env | cut -d'=' -f2 | grep -v '^[0-9a-fA-F]\{64\}$'
```

**해결**: 키 값에서 공백과 특수문자를 제거하세요.

### 오류 3: 파일 권한이 600이 아님
```bash
# 확인
stat -c "%a" .env
# 출력이 600이 아니면
chmod 600 .env
```

---

## ✅ 최종 확인 체크리스트

- [x] 파일 권한: `600` (-rw-------) ✅
- [x] 파일 형식: `JUMIN_ENCRYPTION_KEY=값` ✅
- [x] 키 길이: 정확히 `64자리` ✅
- [x] 키 형식: `0-9, a-f` (또는 `A-F`)만 포함 ✅
- [x] 공백 없음: 키 값에 공백이나 줄바꿈 없음 ✅
- [ ] `.gitignore`에 `.env` 포함 (Git 저장소인 경우) - 선택 사항

---

## ✅ 설정 완료 확인

모든 검증이 통과되었습니다:

```bash
✅ 키 길이 올바름 (64자)
✅ 키 형식 올바름 (16진수 64자리)
```

**다음 단계:**
1. PHP 코드에서 키가 정상적으로 로드되는지 확인
2. `pci0327/api/utils/jumin-secure.php` 파일 생성 및 테스트
3. 암호화/복호화 함수 테스트

---

## 📝 다음 작업

`.env` 파일 설정이 완료되었으므로, 이제 다음 단계를 진행할 수 있습니다:

1. **보안 모듈 개발**: `pci0327/api/utils/jumin-secure.php` 파일 생성
2. **테스트**: 암호화/복호화 함수 테스트
3. **API 수정**: 주민번호 저장/조회 API에 암호화 적용

자세한 내용은 `2012DaeriMember-Jumin-암호화-기획.md` 문서를 참조하세요.

---

**작성일**: 2026-01-17  
**최종 업데이트**: 2026-01-17
