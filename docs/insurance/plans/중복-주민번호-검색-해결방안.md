# μ¤‘λ³µ μ£Όλ―Όλ²νΈ κ²€μƒ‰ λ¬Έμ  ν•΄κ²° λ°©μ•

**μ‘μ„±μΌ**: 2026-01-17  
**λ¬Έμ **: μ¤‘λ³µ μ£Όλ―Όλ²νΈλ¥Ό κ°€μ§„ λ μ½”λ“ μ¤‘ `jumin_hash`κ°€ NULLμΈ λ μ½”λ“λ” ν•΄μ‹ κ²€μƒ‰ μ‹ κ²€μƒ‰λμ§€ μ•μ

---

## π” λ¬Έμ  λ¶„μ„

### ν„μ¬ μƒν™©
- μ¤‘λ³µ μ£Όλ―Όλ²νΈ κ·Έλ£Ή: 748κ°
- μ¤‘λ³µ λ μ½”λ“ μ: μ•½ 879κ°
- μ²« λ²μ§Έ λ μ½”λ“: `jumin_hash` μ €μ¥ (κ²€μƒ‰ κ°€λ¥)
- μ¤‘λ³µ λ μ½”λ“: `jumin_hash = NULL` (κ²€μƒ‰ λ¶κ°€)

### λ¬Έμ μ 
ν„μ¬ κ³„νλ κ²€μƒ‰ λ΅μ§:
```php
$where[] = 'm.`jumin_hash` = :jumin_hash';
```

μ΄λ ‡κ² ν•λ©΄:
- β… μ²« λ²μ§Έ λ μ½”λ“: κ²€μƒ‰λ¨ (jumin_hashκ°€ μμ)
- β μ¤‘λ³µ λ μ½”λ“: κ²€μƒ‰ μ•λ¨ (jumin_hashκ°€ NULL)

---

## β… ν•΄κ²° λ°©μ•

### λ°©μ• 1: ν•΄μ‹ κ²€μƒ‰ + NULL λ μ½”λ“ λ³µνΈν™” κ²€μƒ‰ (κ¶μ¥)

**μ¥μ **:
- λ¨λ“  λ μ½”λ“ κ²€μƒ‰ κ°€λ¥
- UNIQUE μ μ•½ μ μ§€ (μ²« λ²μ§Έ λ μ½”λ“λ§ ν•΄μ‹ μ €μ¥)
- λ³΄μ• μ μ§€

**λ‹¨μ **:
- NULL λ μ½”λ“ λ³µνΈν™” ν•„μ” (μ•½κ°„μ μ„±λ¥ μ €ν•)

**κµ¬ν„**:
```php
if (!empty($jumin)) {
    $juminDigits = preg_replace('/[^0-9]/', '', $jumin);
    if (strlen($juminDigits) === 13) {
        $juminHash = hashJumin($juminDigits);
        
        // ν•΄μ‹λ΅ κ²€μƒ‰ (μ²« λ²μ§Έ λ μ½”λ“)
        // + jumin_hashκ°€ NULLμΈ λ μ½”λ“λ„ λ³µνΈν™” ν›„ λΉ„κµ
        $where[] = '(m.`jumin_hash` = :jumin_hash OR m.`jumin_hash` IS NULL)';
        $params[':jumin_hash'] = $juminHash;
        
        // ν›„μ²λ¦¬μ—μ„ jumin_hashκ°€ NULLμΈ λ μ½”λ“λ” λ³µνΈν™” ν›„ λΉ„κµ
        // (μ„±λ¥μ„ μ„ν•΄ WHERE μ μ—μ„ λ¨Όμ € ν•„ν„°λ§)
    }
}
```

**ν›„μ²λ¦¬ λ΅μ§**:
```php
foreach ($rows as &$row) {
    // jumin_hashκ°€ NULLμΈ κ²½μ° λ³µνΈν™” ν›„ λΉ„κµ
    if ($row['jumin_hash'] === null && !empty($row['jumin_encrypted'])) {
        $decryptedJumin = decryptJumin($row['jumin_encrypted']);
        $decryptedDigits = preg_replace('/[^0-9]/', '', $decryptedJumin);
        
        // κ²€μƒ‰μ–΄μ™€ μΌμΉν•μ§€ μ•μΌλ©΄ μ κ±°
        if ($decryptedDigits !== $juminDigits) {
            // λ°°μ—΄μ—μ„ μ κ±°ν•κ±°λ‚ ν”λκ·Έ μ„¤μ •
            continue;
        }
    }
}
```

### λ°©μ• 2: jumin_hash UNIQUE μ μ•½ μ κ±°

**μ¥μ **:
- λ¨λ“  λ μ½”λ“μ— ν•΄μ‹ μ €μ¥ (κ²€μƒ‰ κ°„λ‹¨)
- λ³µνΈν™” λ¶ν•„μ”

**λ‹¨μ **:
- UNIQUE μ μ•½ μλ―Έ μƒμ‹¤
- μ¤‘λ³µ μ£Όλ―Όλ²νΈ λ°©μ§€ λ¶κ°€

**κµ¬ν„**:
```sql
-- UNIQUE μ μ•½ μ κ±°
ALTER TABLE `2012DaeriMemberSecure` 
DROP INDEX `idx_jumin_hash`;

-- μΌλ° μΈλ±μ¤λ΅ λ³€κ²½
ALTER TABLE `2012DaeriMemberSecure` 
ADD INDEX `idx_jumin_hash` (`jumin_hash`);
```

κ·Έλ¦¬κ³  λ§μ΄κ·Έλ μ΄μ… μ¤ν¬λ¦½νΈ μμ •:
- μ¤‘λ³µ μ£Όλ―Όλ²νΈλ„ `jumin_hash` μ €μ¥

---

## π― κ¶μ¥ μ‚¬ν•­

**λ°©μ• 1 (ν•΄μ‹ κ²€μƒ‰ + NULL λ μ½”λ“ λ³µνΈν™” κ²€μƒ‰)μ„ κ¶μ¥ν•©λ‹λ‹¤.**

**μ΄μ **:
1. β… λ³΄μ•: UNIQUE μ μ•½ μ μ§€λ΅ μ¤‘λ³µ μ£Όλ―Όλ²νΈ λ°©μ§€
2. β… μ™„μ „μ„±: λ¨λ“  λ μ½”λ“ κ²€μƒ‰ κ°€λ¥
3. β… μ„±λ¥: λ€λ¶€λ¶„μ λ μ½”λ“λ” ν•΄μ‹ κ²€μƒ‰ (λΉ λ¦„)
4. β… NULL λ μ½”λ“λ” μ†μ (μ•½ 879κ°)μ΄λ―€λ΅ λ³µνΈν™” λ¶€λ‹΄ μ μ

---

## π“ κµ¬ν„ μμ‹

### kj-driver-list.php μμ •

```php
// μ£Όλ―Όλ²νΈ κ²€μƒ‰ (ν•΄μ‹ κΈ°λ° + NULL λ μ½”λ“ λ³µνΈν™” κ²€μƒ‰)
if ($jumin !== '') {
    $juminDigits = preg_replace('/[^0-9]/', '', $jumin);
    if (strlen($juminDigits) === 13) {
        $juminHash = hashJumin($juminDigits);
        
        // ν•΄μ‹λ΅ κ²€μƒ‰ (μ²« λ²μ§Έ λ μ½”λ“ + NULL λ μ½”λ“)
        $where[] = '(m.`jumin_hash` = :jumin_hash OR m.`jumin_hash` IS NULL)';
        $params[':jumin_hash'] = $juminHash;
    }
}

// ... μ΅°ν ν›„ ...

// ν›„μ²λ¦¬: NULL λ μ½”λ“ ν•„ν„°λ§
foreach ($rows as $key => &$row) {
    // jumin_hashκ°€ NULLμΈ κ²½μ° λ³µνΈν™” ν›„ λΉ„κµ
    if ($row['jumin_hash'] === null && !empty($row['jumin_encrypted'])) {
        $decryptedJumin = decryptJumin($row['jumin_encrypted']);
        $decryptedDigits = preg_replace('/[^0-9]/', '', $decryptedJumin);
        
        // κ²€μƒ‰μ–΄μ™€ μΌμΉν•μ§€ μ•μΌλ©΄ μ κ±°
        if ($decryptedDigits !== $juminDigits) {
            unset($rows[$key]);
        }
    }
}
unset($row);
$rows = array_values($rows); // μΈλ±μ¤ μ¬μ •λ ¬
```

---

## β οΈ μ£Όμμ‚¬ν•­

1. **μ„±λ¥**: NULL λ μ½”λ“ λ³µνΈν™”λ” μ•½κ°„μ μ„±λ¥ μ €ν•κ°€ μμ§€λ§, NULL λ μ½”λ“κ°€ μ†μμ΄λ―€λ΅ ν° λ¬Έμ  μ—†μ
2. **μΈλ±μ¤**: `jumin_hash IS NULL` μ΅°κ±΄μ€ μΈλ±μ¤λ¥Ό μ‚¬μ©ν•μ§€ μ•μΌλ―€λ΅, NULL λ μ½”λ“κ°€ λ§μΌλ©΄ μ„±λ¥ μ €ν• κ°€λ¥
3. **λ€μ•**: NULL λ μ½”λ“κ°€ λ§μ•„μ§€λ©΄ λ°©μ• 2(UNIQUE μ μ•½ μ κ±°)λ¥Ό κ³ λ ¤

---

**μ‘μ„±μΌ**: 2026-01-17  
**μµμΆ… μ—…λ°μ΄νΈ**: 2026-01-17
